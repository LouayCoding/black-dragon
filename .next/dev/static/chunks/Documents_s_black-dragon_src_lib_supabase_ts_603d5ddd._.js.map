{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Louay/Documents/s/black-dragon/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || '';\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || '';\r\n\r\n// Create a dummy client during build if env vars are missing\r\n// This allows the build to succeed, but runtime will show proper errors\r\nconst createSupabaseClient = () => {\r\n  if (supabaseUrl && supabaseAnonKey) {\r\n    return createClient(supabaseUrl, supabaseAnonKey);\r\n  }\r\n  \r\n  // During build or when env vars are missing, return a dummy client\r\n  // that will throw errors at runtime if actually used\r\n  return createClient('https://placeholder.supabase.co', 'placeholder-key');\r\n};\r\n\r\nexport const supabase = createSupabaseClient();\r\n\r\n// Student type matching database schema\r\nexport interface Student {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  phone: string;\r\n  password: string;\r\n  birthdate: string;\r\n  age: number;\r\n  address: string;\r\n  postal_code: string;\r\n  city: string;\r\n  emergency_contact: string;\r\n  emergency_phone: string;\r\n  program: 'little-tigers' | 'youth' | 'women' | 'adult';\r\n  belt: string;\r\n  location: 'Den Haag - Draaistraat' | 'Den Haag - Withuysstraat';\r\n  join_date: string;\r\n  attendance: number;\r\n  last_class: string | null;\r\n  total_classes: number;\r\n  attended_classes: number;\r\n  avatar: string | null;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Fetch all students\r\nexport async function getStudents(): Promise<Student[]> {\r\n  const { data, error } = await supabase\r\n    .from('students')\r\n    .select('*')\r\n    .order('name', { ascending: true });\r\n\r\n  if (error) {\r\n    console.error('Error fetching students:', error);\r\n    throw error;\r\n  }\r\n\r\n  return data || [];\r\n}\r\n\r\n// Fetch single student by ID\r\nexport async function getStudent(id: string): Promise<Student | null> {\r\n  const { data, error } = await supabase\r\n    .from('students')\r\n    .select('*')\r\n    .eq('id', id)\r\n    .single();\r\n\r\n  if (error) {\r\n    console.error('Error fetching student:', error);\r\n    return null;\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\n// Add new student\r\nexport async function addStudent(student: Omit<Student, 'id' | 'created_at' | 'updated_at'>): Promise<Student | null> {\r\n  const { data, error } = await supabase\r\n    .from('students')\r\n    .insert([student])\r\n    .select()\r\n    .single();\r\n\r\n  if (error) {\r\n    console.error('Error adding student:', error);\r\n    throw error;\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\n// Update student\r\nexport async function updateStudent(id: string, updates: Partial<Student>): Promise<Student | null> {\r\n  const { data, error } = await supabase\r\n    .from('students')\r\n    .update(updates)\r\n    .eq('id', id)\r\n    .select()\r\n    .single();\r\n\r\n  if (error) {\r\n    console.error('Error updating student:', error);\r\n    throw error;\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\n// Payment type\r\nexport interface Payment {\r\n  id: string;\r\n  student_id: string;\r\n  amount: number;\r\n  status: 'paid' | 'pending' | 'overdue' | 'cancelled';\r\n  payment_method?: 'cash' | 'card' | 'bank_transfer' | 'ideal';\r\n  payment_date?: string;\r\n  due_date: string;\r\n  description?: string;\r\n  invoice_number?: string;\r\n  notes?: string;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Get overdue payments\r\nexport async function getOverduePayments(): Promise<(Payment & { student: Student })[]> {\r\n  const { data, error } = await supabase\r\n    .from('payments')\r\n    .select('*, student:students(*)')\r\n    .eq('status', 'overdue')\r\n    .order('due_date', { ascending: true })\r\n    .limit(10);\r\n\r\n  if (error) {\r\n    console.error('Error fetching overdue payments:', error);\r\n    return [];\r\n  }\r\n\r\n  return data || [];\r\n}\r\n\r\n// Lesson type\r\nexport interface Lesson {\r\n  id: string;\r\n  title: string;\r\n  title_en?: string;\r\n  program: 'little-tigers' | 'youth' | 'women' | 'adult';\r\n  location: 'Den Haag - Draaistraat' | 'Den Haag - Withuysstraat';\r\n  day_of_week: number;\r\n  start_time: string;\r\n  end_time: string;\r\n  max_students?: number;\r\n  instructor?: string;\r\n  description?: string;\r\n  is_active?: boolean;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Get today's lessons\r\nexport async function getTodaysLessons(): Promise<Lesson[]> {\r\n  const today = new Date().getDay();\r\n  \r\n  const { data, error } = await supabase\r\n    .from('lessons')\r\n    .select('*')\r\n    .eq('day_of_week', today)\r\n    .eq('is_active', true)\r\n    .order('start_time', { ascending: true });\r\n\r\n  if (error) {\r\n    console.error('Error fetching lessons:', error);\r\n    return [];\r\n  }\r\n\r\n  return data || [];\r\n}\r\n\r\n// Event type\r\nexport interface Event {\r\n  id: string;\r\n  title: string;\r\n  title_en?: string;\r\n  type: 'exam' | 'holiday' | 'demo' | 'competition' | 'workshop' | 'other';\r\n  event_date: string;\r\n  start_time?: string;\r\n  end_time?: string;\r\n  location?: string;\r\n  description?: string;\r\n  description_en?: string;\r\n  max_participants?: number;\r\n  current_participants?: number;\r\n  price?: number;\r\n  is_active?: boolean;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Get upcoming events\r\nexport async function getUpcomingEvents(): Promise<Event[]> {\r\n  const today = new Date().toISOString().split('T')[0];\r\n  \r\n  const { data, error } = await supabase\r\n    .from('events')\r\n    .select('*')\r\n    .gte('event_date', today)\r\n    .eq('is_active', true)\r\n    .order('event_date', { ascending: true })\r\n    .limit(5);\r\n\r\n  if (error) {\r\n    console.error('Error fetching events:', error);\r\n    return [];\r\n  }\r\n\r\n  return data || [];\r\n}\r\n\r\n// Activity Log type\r\nexport interface ActivityLog {\r\n  id: string;\r\n  type: 'student' | 'payment' | 'attendance' | 'news' | 'event' | 'other';\r\n  action: string;\r\n  description: string;\r\n  student_id?: string;\r\n  related_id?: string;\r\n  metadata?: any;\r\n  created_at?: string;\r\n}\r\n\r\n// Get recent activity\r\nexport async function getRecentActivity(limit: number = 10): Promise<ActivityLog[]> {\r\n  const { data, error } = await supabase\r\n    .from('activity_logs')\r\n    .select('*')\r\n    .order('created_at', { ascending: false })\r\n    .limit(limit);\r\n\r\n  if (error) {\r\n    console.error('Error fetching activity logs:', error);\r\n    return [];\r\n  }\r\n\r\n  return data || [];\r\n}\r\n\r\n// Attendance type\r\nexport interface Attendance {\r\n  id: string;\r\n  student_id: string;\r\n  lesson_id?: string;\r\n  attendance_date: string;\r\n  status: 'present' | 'absent-sick' | 'absent-unauthorized' | 'absent-vacation' | 'absent-other';\r\n  notes?: string;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Get attendance for date range\r\nexport async function getAttendanceStats(startDate: string, endDate: string): Promise<{ date: string; present: number; total: number }[]> {\r\n  const { data, error } = await supabase\r\n    .from('attendance')\r\n    .select('attendance_date, status')\r\n    .gte('attendance_date', startDate)\r\n    .lte('attendance_date', endDate);\r\n\r\n  if (error) {\r\n    console.error('Error fetching attendance stats:', error);\r\n    return [];\r\n  }\r\n\r\n  // Group by date and calculate percentages\r\n  const grouped = (data || []).reduce((acc: any, record) => {\r\n    const date = record.attendance_date;\r\n    if (!acc[date]) {\r\n      acc[date] = { present: 0, total: 0 };\r\n    }\r\n    acc[date].total++;\r\n    if (record.status === 'present') {\r\n      acc[date].present++;\r\n    }\r\n    return acc;\r\n  }, {});\r\n\r\n  return Object.entries(grouped).map(([date, stats]: [string, any]) => ({\r\n    date,\r\n    present: stats.present,\r\n    total: stats.total,\r\n  }));\r\n}\r\n\r\n// Delete student\r\nexport async function deleteStudent(id: string): Promise<boolean> {\r\n  const { error } = await supabase\r\n    .from('students')\r\n    .delete()\r\n    .eq('id', id);\r\n\r\n  if (error) {\r\n    console.error('Error deleting student:', error);\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n// Program type\r\nexport interface Program {\r\n  id: string;\r\n  name: string;\r\n  name_en: string;\r\n  slug: string;\r\n  age_range: string;\r\n  age_range_en: string;\r\n  description: string;\r\n  description_en: string;\r\n  icon: string;\r\n  color: string;\r\n  features: string[];\r\n  features_en: string[];\r\n  image_url?: string;\r\n  is_active?: boolean;\r\n  display_order?: number;\r\n  created_at?: string;\r\n  updated_at?: string;\r\n}\r\n\r\n// Get all active programs\r\nexport async function getPrograms(): Promise<Program[]> {\r\n  const { data, error } = await supabase\r\n    .from('programs')\r\n    .select('*')\r\n    .eq('is_active', true)\r\n    .order('display_order', { ascending: true });\r\n\r\n  if (error) {\r\n    console.error('Error fetching programs:', error);\r\n    return [];\r\n  }\r\n\r\n  return data || [];\r\n}\r\n"],"names":[],"mappings":"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"}}]
}